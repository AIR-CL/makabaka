<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AdminLTE 3 | Dashboard 2</title>
  <!--导入核心文件-->
  <script src="../controlHtml/bootstrap3/jquery-1.9.1.min.js"></script>
  <link rel="stylesheet"
        href="../controlHtml/plugins/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet"
        href="../controlHtml/plugins/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet"
        href="../controlHtml/plugins/ionicons/css/ionicons.min.css">
  <link rel="stylesheet"
        href="../controlHtml/plugins/iCheck/square/blue.css">
  <link rel="stylesheet"
        href="../controlHtml/plugins/morris/morris.css">
  <link rel="stylesheet"
        href="../controlHtml/plugins/jvectormap/jquery-jvectormap-1.2.2.css">
  <link rel="stylesheet"
        href="../controlHtml/plugins/datepicker/datepicker3.css">
  <link rel="stylesheet"
        href="../controlHtml/plugins/daterangepicker/daterangepicker.css">
  <link rel="stylesheet"
        href="../controlHtml/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">
  <link rel="stylesheet"
        href="../controlHtml/plugins/datatables/dataTables.bootstrap.css">
  <link rel="stylesheet"
        href="../controlHtml/plugins/treeTable/jquery.treetable.css">
  <link rel="stylesheet"
        href="../controlHtml/plugins/treeTable/jquery.treetable.theme.default.css">
  <link rel="stylesheet"
        href="../controlHtml/plugins/select2/select2.css">
  <link rel="stylesheet"
        href="../controlHtml/plugins/colorpicker/bootstrap-colorpicker.min.css">
  <link rel="stylesheet"
        href="../controlHtml/plugins/bootstrap-markdown/css/bootstrap-markdown.min.css">
  <link rel="stylesheet"
        href="../controlHtml/plugins/adminLTE/css/AdminLTE.css">
  <link rel="stylesheet"
        href="../controlHtml/plugins/adminLTE/css/skins/_all-skins.min.css">
  <link rel="stylesheet"
        href="../css/style.css">
  <link rel="stylesheet"
        href="../controlHtml/plugins/ionslider/ion.rangeSlider.css">
  <link rel="stylesheet"
        href="../controlHtml/plugins/ionslider/ion.rangeSlider.skinNice.css">
  <link rel="stylesheet"
        href="../controlHtml/plugins/bootstrap-slider/slider.css">
  <link rel="stylesheet"
        href="../controlHtml/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.css">
  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="../controlHtml/plugins/fontawesome-free/css/all.min.css">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="../controlHtml/plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../controlHtml/dist/css/adminlte.min.css">
  <link rel="">
</head>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">
  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light"  style="background-color: rgba(100,250,150,0.6);">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="index3.html" class="nav-link">主页</a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="#" class="nav-link">交流</a>
      </li>
    </ul>

    <!-- SEARCH FORM -->
    <form class="form-inline ml-3">
      <div class="input-group input-group-sm">
        <input id="search_input" class="form-control form-control-navbar" type="search" placeholder="搜索" aria-label="Search">
        <div class="input-group-append">
          <button id="search_btn" class="btn btn-navbar" >
            <i class="fas fa-search"></i>
          </button>
        </div>
      </div>
    </form>



  <!-- Main Sidebar Container -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4"style="background-color:white">
    <!-- Brand Logo -->
    <a href="index3.html" class="" >
      <img src="../controlHtml/dist/img/logo_img_sc%20(2).png"  class="brand-image  elevation-3" style="opacity:1;height:100px ">
      <span class="brand-text font-weight-light" ></span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar"  style="background-color: rgba(80,160,250,0.7);">
      <!-- Sidebar user panel (optional) -->
      <div class="user-panel mt-3 pb-3 mb-3 d-flex">
        <div class="image">
          <img src="../controlHtml/dist/img/logo_img_sc%20(1).png" class="img-circle elevation-2" alt="User Image">
        </div>
        <div class="info">
          <a href="#" class="d-block">管理员登录</a>
        </div>
      </div>



      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
          <li class="nav-item menu-open">
            <a href="#" class="nav-link active"  style="background-color: rgba(100,230,200,0.7);">
              <i class="nav-icon fas fa-tachometer-alt"></i>
              <p style="color:black">
              信息管理
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>

            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="/admin/toIndex" class="nav-link ">
                  <i class="far fa-circle nav-icon"></i>
                  <p style="color: white">用户信息管理</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="/comic/toIndex" class="nav-link active">
                  <i class="far fa-circle nav-icon"></i>
                  <p>番剧信息管理</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="/admin/toIndex3" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p style="color: white">留言与控制模块</p>
                </a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
    </div>
  </aside>


  </nav>


  <div class="content-wrapper">

      <!-- 内容头部 -->
      <section class="content-header">
        <h1>
          新番创建
        </h1>
      </section>
      <!-- 内容头部 /-->

      <form id="updateForm">
        <!-- 正文区域 -->
        <section class="content"> <!--产品信息-->

          <div class="panel panel-default">
            <div class="row data-type">

              <div class="col-md-2 title">动漫名称</div>
              <input type="hidden" name="comicId" id="comicId">
              <div class="col-md-4 data">
                <input readonly="readonly" type="text" class="form-control" name="comicName" id="comicName"
                       placeholder="动漫名称" value="">
              </div>

              <div class="col-md-2 title">播送时间</div>
              <div class="col-md-4 data">
                <input type="text" class="form-control" name="broadcastTime" id="broadcastTime"
                       placeholder="播送时间" value="">
              </div>

              <div class="col-md-2 title">配音</div>
              <div class="col-md-4 data">
                <input type="text" class="form-control" name="dubbing" id="dubbing"
                       placeholder="配音" value="">
              </div>


              <div class="col-md-2 title">动漫类型</div>
              <div class="col-md-4 data">
                <select class="form-control select2" style="width: 100%"
                        name="comicType" id="comicType">
                  <option value="国漫" selected="selected">国漫</option>
                  <option value="日漫">日漫</option>
                </select>
              </div>

              <div class="col-md-2 title">封面上传</div>
              <div class="col-md-4 data">
                <input type="file" class="form-control" placeholder="封面"
                       name="comicFace" id="comicFace" >
              </div>

              <div class="col-md-2 title">动漫状态</div>
              <div class="col-md-4 data">
                <select class="form-control select2" style="width: 100%"
                        name="comicState" id="comicState">
                  <option value="已完结" selected="selected">已完结</option>
                  <option value="更新中">更新中</option>
                </select>
              </div>
              <!--选择图片-->
               <!-- <div class="form-group">
                  <form class="form-horizontal" id="form-avatar" method="post" role="form"  action="/member/avatar.html" enctype="multipart/form-data" onSubmit="return false;">
                    <div class="avatar-body">
                      <div class="avatar-upload">
                        <label for="avatarInput" style="line-height:35px; width:auto; margin-right:20px; font-weight:bold">头像上传</label>
                        <label class="avatar-input btn btn-primary" for="inputImage" style="float:left">
                          <input type="file" >请选择图片</label>
                        <input name="x" type="hidden">
                        <input name="y" type="hidden">
                        <input name="w" type="hidden">
                        <input name="h" type="hidden">
                      </div>
                      <div class="row ceshi">
                        <div class="col-md-9 col-sm-9 col-xs-9">
                          <div class="avatar-view">
                            <img id="avatar-image" src="../resources/tpl/cms/avatar/444.jpg">
                          </div>
                        </div>
                        <div class="col-md-3 col-sm-3 col-xs-3" id="preview">
                          <div class="avatar-preview avatar-preview-lg"></div>
                          <div class="avatar-preview avatar-preview-md"></div>
                          <div class="avatar-preview avatar-preview-sm" style="float:right"></div>
                        </div>
                      </div>
                      <div class="row avatar-tool">
                        <div class="col-md-9 col-sm-9 col-xs-9">
                          <div class="btn-group">
                            <button class="btn btn-primary fa fa-repeat" data-method="rotate" data-option="-45" type="button">右旋</button>
                            <button class="btn btn-primary fa fa-repeat" data-method="rotate" data-option="90" type="button">右旋</button>
                          </div>
                          <div class="btn-group">
                            <button class="btn btn-primary fa fa-repeat" data-method="zoom" data-option="0.1" type="button"> 放大</button>
                            <button class="btn btn-primary fa fa-repeat" data-method="zoom" data-option="-0.1" type="button"> 缩小</button>
                          </div>
                          <div class="btn-group">
                            <button class="btn btn-primary fa fa-repeat" data-method="move" data-option="-10" data-second-option="0" type="button">左</button>
                            <button class="btn btn-primary fa fa-repeat" data-method="move" data-option="10" data-second-option="0"  type="button">右</button>
                            <button class="btn btn-primary fa fa-repeat" data-method="move" data-option="0" data-second-option="-10" type="button">上</button>
                            <button class="btn btn-primary fa fa-repeat" data-method="move" data-option="0" data-second-option="10" type="button">下</button>
                          </div>
                          <div class="btn-group">
                            <button class="btn btn-primary fa fa-repeat" data-method="scaleX" data-option="-1" type="button">左右</button>
                            <button class="btn btn-primary fa fa-repeat" data-method="scaleY" data-option="-1" type="button">上下</button>
                          </div>
                        </div>
                        <div class="col-md-3 col-sm-3 col-xs-3">
                          <button type="button" class="btn btn-success btn-block" id="submit-avatar">保存</button>
                        </div>
                      </div>
                    </div>
                  </form>
                </div>-->
              <!--/选择图片-->
            </div>
          </div>
          <!--订单信息/--> <!--工具栏-->
          <div class="box-tools text-center">
            <button id="updateBtn" class="btn bg-maroon">保存</button>
            <button type="button" class="btn bg-default"
                    onclick="history.back(-1);">返回</button>
          </div>
          <!--工具栏/--> </section>
        <!-- 正文区域 /-->
      </form>
  </div>
</div>
<script src="../controlHtml/plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="../controlHtml/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- overlayScrollbars -->
<script src="../controlHtml/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
<!-- AdminLTE App -->
<script src="../controlHtml/dist/js/adminlte.js"></script>

<!-- PAGE ../controlHtml/plugins -->
<!-- jQuery Mapael -->
<script src="../controlHtml/plugins/jquery-mousewheel/jquery.mousewheel.js"></script>
<script src="../controlHtml/plugins/raphael/raphael.min.js"></script>
<script src="../controlHtml/plugins/jquery-mapael/jquery.mapael.min.js"></script>
<script src="../controlHtml/plugins/jquery-mapael/maps/usa_states.min.js"></script>
<!-- ChartJS -->
<script src="../controlHtml/plugins/chart.js/Chart.min.js"></script>

<!-- AdminLTE for demo purposes -->
<script src="../controlHtml/dist/js/demo.js"></script>
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script src="../controlHtml/dist/js/pages/dashboard2.js"></script>

<script
  src="../controlHtml/plugins/bootstrap/js/bootstrap.min.js"></script>
<script
  src="../controlHtml/plugins/raphael/raphael-min.js"></script>
<script
  src="../controlHtml/plugins/morris/morris.min.js"></script>
<script
  src="../controlHtml/plugins/sparkline/jquery.sparkline.min.js"></script>
<script
  src="../controlHtml/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
<script
  src="../controlHtml/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
<script
  src="../controlHtml/plugins/knob/jquery.knob.js"></script>
<script
  src="../controlHtml/plugins/daterangepicker/moment.min.js"></script>
<script
  src="../controlHtml/plugins/daterangepicker/daterangepicker.js"></script>
<script
  src="../controlHtml/plugins/daterangepicker/daterangepicker.zh-CN.js"></script>
<script
  src="../controlHtml/plugins/datepicker/bootstrap-datepicker.js"></script>
<script
  src="../controlHtml/plugins/datepicker/locales/bootstrap-datepicker.zh-CN.js"></script>
<script
  src="../controlHtml/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
<script
  src="../controlHtml/plugins/slimScroll/jquery.slimscroll.min.js"></script>
<script
  src="../controlHtml/plugins/fastclick/fastclick.js"></script>
<script
  src="../controlHtml/plugins/iCheck/icheck.min.js"></script>
<script
  src="../controlHtml/plugins/adminLTE/js/app.min.js"></script>
<script
  src="../controlHtml/plugins/treeTable/jquery.treetable.js"></script>
<script
  src="../controlHtml/plugins/select2/select2.full.min.js"></script>
<script
  src="../controlHtml/plugins/colorpicker/bootstrap-colorpicker.min.js"></script>
<script
  src="../controlHtml/plugins/bootstrap-wysihtml5/bootstrap-wysihtml5.zh-CN.js"></script>
<script
  src="../controlHtml/plugins/bootstrap-markdown/js/bootstrap-markdown.js"></script>
<script
  src="../controlHtml/plugins/bootstrap-markdown/locale/bootstrap-markdown.zh.js"></script>
<script
  src="../controlHtml/plugins/bootstrap-markdown/js/markdown.js"></script>
<script
  src="../controlHtml/plugins/bootstrap-markdown/js/to-markdown.js"></script>
<script
  src="../controlHtml/plugins/ckeditor/ckeditor.js"></script>
<script
  src="../controlHtml/plugins/input-mask/jquery.inputmask.js"></script>
<script
  src="../controlHtml/plugins/input-mask/jquery.inputmask.date.extensions.js"></script>
<script
  src="../controlHtml/plugins/input-mask/jquery.inputmask.extensions.js"></script>
<script
  src="../controlHtml/plugins/datatables/jquery.dataTables.min.js"></script>
<script
  src="../controlHtml/plugins/datatables/dataTables.bootstrap.min.js"></script>
<script
  src="../controlHtml/plugins/chartjs/Chart.min.js"></script>
<script
  src="../controlHtml/plugins/flot/jquery.flot.min.js"></script>
<script
  src="../controlHtml/plugins/flot/jquery.flot.resize.min.js"></script>
<script
  src="../controlHtml/plugins/flot/jquery.flot.pie.min.js"></script>
<script
  src="../controlHtml/plugins/flot/jquery.flot.categories.min.js"></script>
<script
  src="../controlHtml/plugins/ionslider/ion.rangeSlider.min.js"></script>
<script
  src="../controlHtml/plugins/bootstrap-slider/bootstrap-slider.js"></script>
<script
  src="../controlHtml/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.js"></script>
<script
  src="../controlHtml/plugins/bootstrap-datetimepicker/locales/bootstrap-datetimepicker.zh-CN.js"></script>
</body>
<!--<script>
  <script type="text/javascript">var console = window.console || { log: function () {} };
  var $image = $("#avatar-image");
  // 获取裁切时的四个框
  var x = $("input[name=x]");
  var y = $("input[name=y]");
  var w = $("input[name=w]");
  var h = $("input[name=h]");
  //选择图片时预览图片 并 调用cropper插件
  $("input[type=file]").change(function() {
    // 先消毁，清除一下插件，否则连续调用插件时会失败
    $image.cropper("destroy");
    // this.files[0]：获取当前图片并转成URL地址
    var url = getObjectUrl(this.files[0]);
    console.log(url)
    $image.attr('src', url);// 设置url到预览图片上
    // 调出插件
    $image.cropper({
      // 裁切的框形状
      aspectRatio: 1/1,
      // 显示预览的位置
      preview:'.avatar-preview',
      // 显示模式：图片不能无限缩小，但可以放大
      viewMode: 1,
      // 裁切时把参数保存到表单中
      crop: function(event) {
        x.val(event.detail.x);
        y.val(event.detail.y);
        w.val(event.detail.width);
        h.val(event.detail.height);
        w.val(event.detail.width);
      }
    });
  });
  // 预览时需要使用下面这个函数转换一下
  function getObjectUrl(file) {
    var url = null;
    if (window.createObjectURL != undefined) {
      url = window.createObjectURL(file)
    } else if (window.URL != undefined) {
      url = window.URL.createObjectURL(file)
    } else if (window.webkitURL != undefined) {
      url = window.webkitURL.createObjectURL(file)
    }
    return url
  }
  // Methods
  $('.avatar-tool').on('click', '[data-method]', function() {
    var $this = $(this);
    var data = $this.data();
    var cropper = $image.data('cropper');
    var cropped;
    var $target;
    var result;
    if ($this.prop('disabled') || $this.hasClass('disabled')) {
      return;
    }
    if (cropper && data.method) {
      data = $.extend({}, data); // Clone a new one
      if (typeof data.target !== 'undefined') {
        $target = $(data.target);
        if (typeof data.option === 'undefined') {
          try {
            data.option = JSON.parse($target.val());
          } catch (e) {
            console.log(e.message);
          }
        }
      }
      cropped = cropper.cropped;
      switch (data.method) {
        case 'rotate':
          if (cropped) {
            $image.cropper('clear');
          }
          break;
        case 'getCroppedCanvas':
          if (uploadedImageType === 'image/jpeg') {
            if (!data.option) {
              data.option = {};
            }
            data.option.fillColor = '#fff';
          }
          break;
      }
      result = $image.cropper(data.method, data.option, data.secondOption);
      switch (data.method) {
        case 'rotate':
          if (cropped) {
            $image.cropper('crop');
          }
          break;
        case 'scaleX':
        case 'scaleY':
          $(this).data('option', -data.option);
          break;
        case 'getCroppedCanvas':
          if (result) {
            // Bootstrap's Modal
            $('#getCroppedCanvasModal').modal().find('.modal-body').html(result);

            if (!$download.hasClass('disabled')) {
              download.download = uploadedImageName;
              $download.attr('href', result.toDataURL(uploadedImageType));
            }
          }
          break;
        case 'destroy':
          if (uploadedImageURL) {
            URL.revokeObjectURL(uploadedImageURL);
            uploadedImageURL = '';
            $image.attr('src', originalImageURL);
          }
          break;
      }
      if ($.isPlainObject(result) && $target) {
        try {
          $target.val(JSON.stringify(result));
        } catch (e) {
          console.log(e.message);
        }
      }
    }
  });
  $("#submit-avatar").click(function(e) {
    var $imgData = $image.cropper('getCroppedCanvas');
    var dataurl = $imgData.toDataURL('image/jpg');
    var blob = dataURLtoBlob(dataurl);
    var form = document.querySelector("#form-avatar");
    var formData = new FormData(form);
    formData.append("file", blob);
    $.showfloatdiv({
      txt: '头像上传中...',
      cssname: 'loading'
    });
    $.ajax({
      url: '/member/avatar.html',
      type: 'post',
      dataType: 'json',
      data: formData,
      cache: false,
      processData: false,
      contentType: false,
      success: function(r) {
        $.hidediv(r);
        if (parseInt(r.code) > 0) {
          $("#avatar").attr("src",r.data+'?'+ Math.random());
        }
      },
      error: function(r) {
        $.hidediv(r);
      },
    });
    return false;
  });
  //将base64格式图片转换为文件形式
  function dataURLtoBlob(dataurl) {
    var arr = dataurl.split(','),
      mime = arr[0].match(/:(.*?);/)[1],
      bstr = atob(arr[1]),
      n = bstr.length,
      u8arr = new Uint8Array(n);
    while (n&#45;&#45;) {
      u8arr[n] = bstr.charCodeAt(n);
    }
    return new Blob([u8arr], {
      type: mime
    });
  }
  $(function () {
    $(".avatar-view").height($('#preview').height()-25);
    $(window).resize(function() {
      $(".avatar-view").height($('#preview').height()-25);
    });
  });
  $(".nav-tabs li a").click(function() {
    $('#tab_3').removeClass("visibility");
    $('#tab_3').addClass("tab-pane");

  });

  //$(document).ready(function(){
  //  //alert($(document.body).height())
  //  var mHeight = $('#preview').height();
  //  alert(mHeight)
  //  console.log(mHeight);//0
  // // alert($('.avatar-upload').offset().top)
  ////    //初始化高度
  ////	$height=$(".container").width()*0.75*0.75/2;
  ////    $(".avatar-view").height($height);
  ////	$("#preview").height($height);
  ////    //当文档窗口发生改变时 触发
  ////    $(window).resize(function(){
  ////		$height=$(".container").width()*0.75*0.75/2;
  ////        $(".avatar-view").height($height);
  ////    })
  //})
</script>-->
<script>
  $(function () {
      var url = location.search;
      if (url.indexOf("?") != -1){
        var str = url.substr(1);
        strs = str.split("=");
        var comicId=strs[1];
        $.get("/comic/findComicById",{comicId:comicId},function (data) {
            //根据id把信息回显到页面上
            $("#comicId").val(data.comicId);
            $("#comicName").val(data.comicName);
            $("#broadcastTime").val(data.broadcastTime);
            $("#dubbing").val(data.dubbing);

            $("#comicFace").val(data.comicFace);//此处赋值不知道如何赋值，comicFace暂时为文件路径字符串

            $("#comicType").val(data.comicType);
            $("#comicState").val(data.comicState);

        })
      }

  })
  $("#updateBtn").click(function () {
    var dataForm = document.getElementById("updateForm");
    var data = new FormData(dataForm);
    $.ajax({
      async:false,
      cache:false,
      url:"/comic/updateComic",
      type: "post",
      data: data,
      processData: false,
      contentType: false,
      success:function (data) {
        if (data.state===200){
          alert(data.msg);
          window.location.href="/comic/toIndex";
        }else{
          alert(data.msg);
        }
      }
    })
  })
</script>
</html>
